<!doctype html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="theme-color" content="#4188c9">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="robots" content="index,follow">
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.kimai.org/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.kimai.org/images/icon_32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.kimai.org/images/icon_16x16.png">
    <title>Docker Compose â€“ Kimai</title>
    <meta name="description" content="Running Kimai with Docker compose">
    <meta property="og:description" content="Running Kimai with Docker compose">
    <meta name="twitter:description" content="Running Kimai with Docker compose">
    <link type="application/atom+xml" rel="alternate" href="https://www.kimai.org/feed.xml" title="Kimai Time-Tracking" />
    <meta property="og:locale" content="en">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Kimai Time-Tracking">
    <meta property="og:image" content="https://www.kimai.org/images/social-preview.webp">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Kimai Time-Tracking">
    <meta name="twitter:site" content="@kimai_org">
    <meta name="twitter:image" content="https://www.kimai.org/images/social-preview.webp">
    <link rel="canonical" href="https://www.kimai.org/documentation/docker-compose.html" />
    <link href="/assets/build/main.css?v6" rel="stylesheet" />
</head>
<body class="">











<header class="header navbar navbar-expand bg-light border-bottom border-light shadow fixed-top" data-scroll-header>
    <div class="container-fluid pe-lg-4">
        <div class="d-flex align-items-center">
            <a href="/" class="navbar-brand flex-shrink-0 py-1 py-lg-2">
                <img src="/images/apple-touch-icon.png" width="32" alt="Kimai logo" class="me-2">
                Kimai Docs
            </a>
            <span class="badge bg-warning">On-Premise</span>
        </div>
        <div class="d-flex align-items-center w-100">
            <ul class="navbar-nav d-none d-lg-flex" style="padding-left: 6.75rem;">
                
                    
                    
                    <li class="nav-item">
                        <a href="/documentation/chapter-manual.html" class="nav-link ">
                            <i class="bx bx-book opacity-70 fs-lg me-1"></i>
                            User manual
                        </a>
                    </li>
                
                    
                    
                    <li class="nav-item">
                        <a href="/documentation/cloud.html" class="nav-link ">
                            <i class="bx bx-cloud opacity-70 fs-lg me-1"></i>
                            Kimai-Cloud
                        </a>
                    </li>
                
                    
                    
                    <li class="nav-item">
                        <a href="/documentation/chapter-on-premise.html" class="nav-link  active">
                            <i class="bx bx-server opacity-70 fs-lg me-1"></i>
                            On-Premise
                        </a>
                    </li>
                
                    
                    
                    <li class="nav-item">
                        <a href="/documentation/chapter-developer.html" class="nav-link ">
                            <i class="bx bx-code-alt opacity-70 fs-lg me-1"></i>
                            Developer
                        </a>
                    </li>
                
            </ul>
            <button type="button" class="navbar-toggler d-block d-lg-none ms-auto me-4" data-bs-toggle="offcanvas" data-bs-target="#componentsNav" aria-controls="componentsNav" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>
</header>

<aside class="bg-dark">
    <div id="componentsNav" class="offcanvas-lg offcanvas-start d-flex flex-column position-fixed top-0 start-0 vh-100 bg-dark border-end-lg" style="width: 19rem; z-index: 1045;">
        <div class="offcanvas-header d-none d-lg-flex justify-content-start">
            <a href="/" class="navbar-brand d-none d-lg-flex py-0">
                <img src="/images/apple-touch-icon.png" width="26" alt="Kimai logo" class="me-3">
                Kimai Docs
            </a>
        </div>
        <div class="offcanvas-header d-block d-lg-none border-bottom">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h5 class="d-lg-none mb-0">Menu</h5>
                <button type="button" class="btn-close d-lg-none" data-bs-dismiss="offcanvas" data-bs-target="#componentsNav" aria-label="Close"></button>
            </div>
            <div class="list-group list-group-flush mx-n4">
                
                    
                    
                    <a href="/documentation/chapter-manual.html" class="list-group-item list-group-item-action d-flex align-items-center border-0 py-1 px-4">
                        <i class="bx bx-book opacity-70 me-1"></i>
                        User manual
                    </a>
                
                    
                    
                    <a href="/documentation/cloud.html" class="list-group-item list-group-item-action d-flex align-items-center border-0 py-1 px-4">
                        <i class="bx bx-cloud opacity-70 me-1"></i>
                        Kimai-Cloud
                    </a>
                
                    
                    
                    <a href="/documentation/chapter-on-premise.html" class="list-group-item list-group-item-action d-flex align-items-center border-0 py-1 px-4">
                        <i class="bx bx-server opacity-70 me-1"></i>
                        On-Premise
                    </a>
                
                    
                    
                    <a href="/documentation/chapter-developer.html" class="list-group-item list-group-item-action d-flex align-items-center border-0 py-1 px-4">
                        <i class="bx bx-code-alt opacity-70 me-1"></i>
                        Developer
                    </a>
                
            </div>
        </div>
        <div class="offcanvas-body overflow-scroll w-100 p-4">
            <div class="h-auto docsnavi">
                
                    
                    
                    
                    
                    <p class="fs-lg mb-1 text-white fw-bold">Cloud setups</p>
                    <div class="list-group list-group-flush mb-4 me-n4 border-start">
                        
                        
                        
                        
                        <a href="/documentation/hosting-hetzner-cloud.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-hosting-hetzner-cloud">
                            
                            Hetzner Cloud
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/hosting-digital-ocean.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-hosting-digital-ocean">
                            
                            DigitalOcean
                            
                        </a>
                        
                        
                    </div>
                    
                    
                    
                    <p class="fs-lg mb-1 text-white fw-bold">Using Docker</p>
                    <div class="list-group list-group-flush mb-4 me-n4 border-start">
                        
                        
                        
                        
                        <a href="/documentation/docker.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-docker">
                            
                            Docker
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/docker-compose.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2  active" id="docnavi-docker-compose">
                            
                            Docker Compose
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/kubernetes.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-kubernetes">
                            
                            Kubernetes
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/building-docker.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-building-docker">
                            
                            Build your image
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/docker-troubleshooting.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-docker-troubleshooting">
                            
                            Troubleshooting
                            
                        </a>
                        
                        
                    </div>
                    
                    
                    
                    <p class="fs-lg mb-1 text-white fw-bold">Setup with SSH</p>
                    <div class="list-group list-group-flush mb-4 me-n4 border-start">
                        
                        
                        
                        
                        <a href="/documentation/installation.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-installation">
                            
                            Installation
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/updates.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-updates">
                            
                            Updates
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/cache.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-cache">
                            
                            Reloading cache
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/plugin-management.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-plugin-management">
                            
                            Plugins
                            
                        </a>
                        
                        
                    </div>
                    
                    
                    
                    <p class="fs-lg mb-1 text-white fw-bold">Other setups</p>
                    <div class="list-group list-group-flush mb-4 me-n4 border-start">
                        
                        
                        
                        
                        <a href="/documentation/fresh-ubuntu-22.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-fresh-ubuntu-22">
                            
                            Ubuntu 22.04
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/webserver-configuration.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-webserver-configuration">
                            
                            Webserver
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/synology.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-synology">
                            
                            Synology NAS
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/shared-hosting.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-shared-hosting">
                            
                            Shared hosting
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/hosting-1-click.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-hosting-1-click">
                            
                            1-click installations
                            
                        </a>
                        
                        
                    </div>
                    
                    
                    
                    <p class="fs-lg mb-1 text-white fw-bold">DevOps</p>
                    <div class="list-group list-group-flush mb-4 me-n4 border-start">
                        
                        
                        
                        
                        <a href="/documentation/backups.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-backups">
                            
                            Backups
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/local-yaml.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-local-yaml">
                            
                            Configuration files
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/emails.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-emails">
                            
                            Emails
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/logging.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-logging">
                            
                            Logging
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/commands.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-commands">
                            
                            Commands
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/faq-onpremise.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-faq-onpremise">
                            
                            FAQ
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/migration-v1.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-migration-v1">
                            
                            Migrate from Kimai v1
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/versions.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-versions">
                            
                            Kimai versions
                            
                        </a>
                        
                        
                    </div>
                    
                    
                    
                    <p class="fs-lg mb-1 text-white fw-bold">Authenticator</p>
                    <div class="list-group list-group-flush mb-4 me-n4 border-start">
                        
                        
                        
                        
                        <a href="/documentation/ldap.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-ldap">
                            
                            LDAP
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/saml.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-saml">
                            
                            SAML
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/saml-azure.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-saml-azure">
                            
                            Azure SAML
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/saml-google.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-saml-google">
                            
                            Google SAML
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/saml-keycloak.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-saml-keycloak">
                            
                            Keycloak SAML
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/saml-authentik.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-saml-authentik">
                            
                            Authentik SAML
                            
                        </a>
                        
                        
                        
                        
                        
                        <a href="/documentation/saml-adfs.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-saml-adfs">
                            
                            Microsoft ADFS
                            
                        </a>
                        
                        
                    </div>
                    
                    
                    
                    <p class="fs-lg mb-1 text-white fw-bold">Plugins</p>
                    <div class="list-group list-group-flush mb-4 me-n4 border-start">
                        
                        
                        
                        
                        <a href="/documentation/plugin-contract.html" class="list-group-item ms-2 list-group-item-action border-0 ps-2 " id="docnavi-plugin-contract">
                            
                            Working contract
                            
                        </a>
                        
                        
                    </div>
                    
                    <div class="list-group list-group-flush pb-3 mb-4 mx-n4">
                
                    <a href="/" class="list-group-item list-group-item-action border-0 py-1 fs-sm px-4">Kimai Home</a>
                    <a href="/en/site-notice.html" class="list-group-item list-group-item-action border-0 py-1 fs-sm px-4">Site notice</a>
                    <a href="/en/privacy-policy.html" class="list-group-item list-group-item-action border-0 py-1 fs-sm px-4">Privacy policy</a>
                </div>
            </div>
        </div>
    </div>
</aside>
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        const dpm = document.getElementById('docnavi-docker-compose');
        if (dpm !== null) {
            dpm.scrollIntoView({ behavior: "smooth", block: "end", inline: "nearest" });
        }
    });
</script>
<main class="docs-container pt-5">
    <div class="container-fluid px-xxl-5 px-lg-4 pt-4 pt-lg-5 pb-2 pb-lg-4">

        <div class="d-sm-flex align-items-end justify-content-between ps-lg-2 ps-xxl-0 mt-2 mt-lg-0 pt-4 mb-n3">
            <div class="me-4">
                <h1 class="pb-1">Docker Compose</h1>
                
                <p class="text-muted fs-lg mb-2">Running Kimai with Docker compose</p>
                
            </div>
            





        </div>

        <div class="markdown py-5 ps-lg-2 ps-xxl-0">
            <div>
                
                <div id="documentation-content">
                    <p>Several docker-compose example files that use the latest Kimai version.</p>

<h2 id="apache-prod">Apache (prod)</h2>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:

  sqldb:
    image: mysql:8.3
    volumes:
      - mysql:/var/lib/mysql
    environment:
      - MYSQL_DATABASE=kimai
      - MYSQL_USER=kimaiuser
      - MYSQL_PASSWORD=kimaipassword
      - MYSQL_ROOT_PASSWORD=changemeplease
    command: --default-storage-engine innodb
    restart: unless-stopped
    healthcheck:
      test: mysqladmin -p$$MYSQL_ROOT_PASSWORD ping -h localhost
      interval: 20s
      start_period: 10s
      timeout: 10s
      retries: 3

  kimai:
    image: kimai/kimai2:apache
    volumes:
      - data:/opt/kimai/var/data
      - plugins:/opt/kimai/var/plugins
    ports:
      - 8001:8001
    environment:
      - ADMINMAIL=admin@kimai.local
      - ADMINPASS=changemeplease
      - "DATABASE_URL=mysql://kimaiuser:kimaipassword@sqldb/kimai?charset=utf8mb4&amp;serverVersion=8.3.0"
    restart: unless-stopped

volumes:
  data:
  mysql:
  plugins:
</code></pre></div></div>

<h2 id="environment-variables">Environment variables</h2>

<p>Instead of hardcoding your credentials and/or duplicating them in several places, you can also use a <code class="language-plaintext highlighter-rouge">.env</code> file like that:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DATABASE_NAME=kimai
DATABASE_USER=kimaiuser
DATABASE_PASSWORD=kimaipassword
DATABASE_ROOT_PASSWORD=changemeplease
ADMIN_EMAIL=admin@kimai.local
ADMIN_PASSWORD=changemeplease
</code></pre></div></div>

<p>And then reference those from your <code class="language-plaintext highlighter-rouge">docker-compose.yaml</code>:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:

  sqldb:
    image: mysql:8.3
    volumes:
      - mysql:/var/lib/mysql
    environment:
      - MYSQL_DATABASE=${DATABASE_NAME}
      - MYSQL_USER=${DATABASE_USER}
      - MYSQL_PASSWORD=${DATABASE_PASSWORD}
      - MYSQL_ROOT_PASSWORD=${DATABASE_ROOT_PASSWORD}
    command: --default-storage-engine innodb
    restart: unless-stopped
    healthcheck:
      test: mysqladmin -p$$MYSQL_ROOT_PASSWORD ping -h localhost
      interval: 20s
      start_period: 10s
      timeout: 10s
      retries: 3

  kimai:
    image: kimai/kimai2:apache
    volumes:
      - data:/opt/kimai/var/data
      - plugins:/opt/kimai/var/plugins
    ports:
      - 8001:8001
    environment:
      - ADMINMAIL=${ADMIN_EMAIL}
      - ADMINPASS=${ADMIN_PASSWORD}
      - "DATABASE_URL=mysql://${DATABASE_USER}:${DATABASE_PASSWORD}@sqldb/${DATABASE_NAME}?charset=utf8mb4&amp;serverVersion=8.3.0"
    restart: unless-stopped

volumes:
  data:
  mysql:
  plugins:
</code></pre></div></div>

<h2 id="caddy-reverse-proxy">Caddy Reverse Proxy</h2>

<p>Kimai has extensive examples of using Caddy as reverse proxy in frontend of Kimai.</p>

<p>See <a href="/documentation/hosting-hetzner-cloud.html">Hetzner Cloud</a> and <a href="/documentation/hosting-digital-ocean.html">Digital Ocean</a> docs.</p>

<h2 id="installing-plugins">Installing plugins</h2>

<p>When using plugins, you can either use a <a href="https://docs.docker.com/engine/storage/volumes/">volume</a> or a <a href="https://docs.docker.com/engine/storage/bind-mounts/">bind mount</a>.
As plugin are accessed read-only by Kimai, you can use both methods.</p>

<p>Using a volume:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:
    [...]

  kimai:
    image: kimai/kimai2:apache
    volumes:
      - data:/opt/kimai/var/data
      - plugins:/opt/kimai/var/plugins
    [...]

volumes:
  data:
  plugins:
</code></pre></div></div>

<p>Or using a bind mount, pointing to the local filesystem at <code class="language-plaintext highlighter-rouge">/home/kimai/plugins</code>:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:

  sqldb:
    [...]

  kimai:
    image: kimai/kimai2:apache
    volumes:
      - data:/opt/kimai/var/data
      - /home/kimai/plugins:/opt/kimai/var/plugins
    [...]

volumes:
  data:
</code></pre></div></div>

<p>Once the Docker container is running up, you need to step into the container and install the plugin:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">exec</span> <span class="nt">-ti</span> kimai /opt/kimai/bin/console cache:clear <span class="nt">--env</span><span class="o">=</span>prod
docker <span class="nb">exec</span> <span class="nt">-ti</span> kimai /opt/kimai/bin/console kimai:bundle:workcontract:install
</code></pre></div></div>

<h2 id="using-a-localyaml">Using a local.yaml</h2>

<p>This requires a new mount, e.g. mounting the local file <code class="language-plaintext highlighter-rouge">/home/kimai/local.yaml</code> into the correct location inside the image.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:
    [...]

  kimai:
    image: kimai/kimai2:apache
    volumes:
      - data:/opt/kimai/var/data
      - plugins:/opt/kimai/var/plugins
      - /home/kimai/local.yaml:/opt/kimai/config/packages/local.yaml
      
    [...]

volumes:
  data:
  plugins:
</code></pre></div></div>

<h2 id="fpm-and-nginx">FPM and nginx</h2>

<p>Listed here are example setups for running the image(s).
If youâ€™d like to contribute a new one them please <a href="https://github.com/kimai/www.kimai.org/edit/main/_documentation/docker/docker-compose.md">raise a PR for this page</a>.</p>

<div class="alert alert-danger d-flex" role="alert"><i class="bx bx-info-circle lead me-3"></i>
<p>Be aware that the below image <a href="https://github.com/tobybatch/nginx-fpm-reverse-proxy">tobybatch/nginx-fpm-reverse-proxy</a> is only meant as example.
It is not made for production usage. Use your existing reverse proxy instead!</p>
</div>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:

  sqldb:
    image: mysql:8.3
    volumes:
      - mysql:/var/lib/mysql
    environment:
      - MYSQL_DATABASE=kimai
      - MYSQL_USER=kimaiuser
      - MYSQL_PASSWORD=kimaipassword
      - MYSQL_ROOT_PASSWORD=changemeplease
    command: --default-storage-engine innodb
    restart: unless-stopped
    healthcheck:
      test: mysqladmin -p$$MYSQL_ROOT_PASSWORD ping -h localhost
      interval: 20s
      start_period: 10s
      timeout: 10s
      retries: 3

  nginx:
    image: tobybatch/nginx-fpm-reverse-proxy
    ports:
      - 8001:80
    volumes:
      - public:/opt/kimai/public:ro
    restart: unless-stopped
    depends_on:
      - kimai
    healthcheck:
      test:  wget --spider http://nginx/health || exit 1
      interval: 20s
      start_period: 10s
      timeout: 10s
      retries: 3

  kimai:
    image: kimai/kimai2:latest
    environment:
      - ADMINMAIL=admin@kimai.local
      - ADMINPASS=changemeplease
      - "DATABASE_URL=mysql://kimaiuser:kimaipassword@sqldb/kimai?charset=utf8mb4&amp;serverVersion=8.3.0"
    volumes:
      - public:/opt/kimai/public
      - plugins:/opt/kimai/var/plugins
      <span class="c"># - data:/opt/kimai/var/data</span>
      <span class="c"># - ./ldap.conf:/etc/openldap/ldap.conf:z</span>
      <span class="c"># - ./ROOT-CA.pem:/etc/ssl/certs/ROOT-CA.pem:z</span>
    restart: unless-stopped

volumes:
    data:
    public:
    mysql:
    plugins:
</code></pre></div></div>

<h2 id="updating-kimai">Updating Kimai</h2>

<p>The usual update step is simple: stop, pull latest version, restart.</p>

<p>This example is based on the <code class="language-plaintext highlighter-rouge">Apache</code> image used with the <code class="language-plaintext highlighter-rouge">Docker compose</code> plugin:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Pull latest version</span>
docker compose pull
<span class="c"># Stop and remove older version</span>
docker compose down
<span class="c"># Start the container</span>
docker compose up <span class="nt">-d</span>
</code></pre></div></div>

<h3 id="fpm-image">FPM image</h3>

<p>The FPM image will need to be upgraded with a manual step.
Because the FPM image will have a HTTP proxy (e.g. caddy or nginx) serving the static assets the <code class="language-plaintext highlighter-rouge">public</code> directory is mounted into that container. This is done via volumes:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
    <span class="na">kimai</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">kimai/kimai2:latest</span>
        <span class="s">...</span>
        <span class="na">volumes</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">public:/opt/kimai/public</span>
        <span class="s">...</span>
    <span class="na">nginx</span><span class="pi">:</span>
        <span class="s">...</span>
        <span class="s">volumes</span><span class="err">:</span>
            <span class="pi">-</span> <span class="s">public:/opt/kimai/public:ro</span>
    <span class="s">...</span>
</code></pre></div></div>

<p>When the Kimai image is updated, and the container is restarted any new assets in the public directory are never included.
These will be things like CSS files, images and especially version specific javascript code!
To fix this you need to copy the newer files from a fresh image over the top.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># You might need to use `docker volume ls | grep kimai` to find the name of your Kimai "public" volume</span>
docker run <span class="nt">--rm</span> <span class="nt">-ti</span> <span class="nt">-v</span> kimai_public:/public <span class="nt">--entrypoint</span> /bin/bash kimai/kimai2
<span class="c">#                      ^^^^^^^^^^^^ -&gt; Kimai public volume</span>
<span class="nb">cp</span> <span class="nt">-r</span> /opt/kimai/public /
<span class="nb">exit</span>
</code></pre></div></div>

<p>Now youâ€™ll need to tell the running kimai to update its assets:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose <span class="nb">exec </span>kimai /opt/kimai/bin/console assets:install
</code></pre></div></div>

<h2 id="apache-dev">Apache (dev)</h2>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>services:

  sqldb:
    image: mysql:8.3
    environment:
      - MYSQL_DATABASE=kimai
      - MYSQL_USER=kimaiuser
      - MYSQL_PASSWORD=kimaipassword
      - MYSQL_ROOT_PASSWORD=changemeplease
    command: --default-storage-engine innodb
    restart: unless-stopped
    healthcheck:
      test: mysqladmin -p$$MYSQL_ROOT_PASSWORD ping -h localhost
      interval: 20s
      start_period: 10s
      timeout: 10s
      retries: 3

  kimai:
    image: kimai/kimai2:apache-dev
    ports:
      - 8001:8001
    environment:
      - ADMINMAIL=admin@kimai.local
      - ADMINPASS=changemeplease
      - "DATABASE_URL=mysql://kimaiuser:kimaipassword@sqldb/kimai?charset=utf8mb4&amp;serverVersion=8.3.0"
    restart: unless-stopped
</code></pre></div></div>

                </div>
                

                
            </div>
        </div>

    </div>
</main>


    <aside class="side-nav side-nav-end d-none d-xxl-block position-fixed top-0 end-0 vh-100 py-5" style="width: 20rem;">
        <h3 class="fs-lg mt-5 pt-5">Jump to</h3>
        <ul class="nav" id="jumpToNav"><li class="nav-item"><a href="#apache-prod" class="nav-link">Apache (prod)</a></li><li class="nav-item"><a href="#environment-variables" class="nav-link">Environment variables</a></li><li class="nav-item"><a href="#caddy-reverse-proxy" class="nav-link">Caddy Reverse Proxy</a></li><li class="nav-item"><a href="#installing-plugins" class="nav-link">Installing plugins</a></li><li class="nav-item"><a href="#using-a-localyaml" class="nav-link">Using a local.yaml</a></li><li class="nav-item"><a href="#fpm-and-nginx" class="nav-link">FPM and nginx</a></li><li class="nav-item"><a href="#updating-kimai" class="nav-link">Updating Kimai</a><ul><li class="nav-item"><a href="#fpm-image" class="nav-link">FPM image</a></li></ul></li><li class="nav-item"><a href="#apache-dev" class="nav-link">Apache (dev)</a></li></ul>
        
    </aside>



<a href="#top" class="btn-scroll-top" data-scroll>
    <span class="btn-scroll-top-tooltip text-muted fs-sm me-2">Top</span>
    <i class="btn-scroll-top-icon bx bx-chevron-up"></i>
</a>

<script src="/assets/build/main.js?v1"></script>

<script async defer src="https://sa.kimai.org/latest.js"></script>
<noscript><img src="https://sa.kimai.org/noscript.gif" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript>

</body>
</html>
